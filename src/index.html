<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8" />
        <title>Stellar Engine Demo</title>
        <style type="text/css">

            html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            body {
                overflow: hidden;
                background-color: #0ec4e1;
            }

            #canvas {
                display: block;
                /*image-rendering: pixelated;*/
                image-rendering: optimizeSpeed;
                image-rendering: -moz-crisp-edges;
                image-rendering: -webkit-optimize-contrast;
                image-rendering: -o-crisp-edges;
                image-rendering: optimize-contrast;
                -ms-interpolation-mode: nearest-neighbor;
             }

             #fps {
                position: absolute;
                bottom: 10px;
                left: 10px;
                color: white;
                font-size: 14px;
             }

        </style>
    </head>

    <body>

        <!-- Scripts -->
        <script src="sprite.js"></script>
        <script src="actor.js"></script>
        <script src="mob.js"></script>
        <script src="player.js"></script>
        <script src="item.js"></script>
        <script src="level.js"></script>
        <script src="loader-tsx.js"></script>
        <script src="loader-tmx.js"></script>
        <script src="render.js"></script>

        <!-- Resources -->
        <div style="display: none;">
            <img id="char1" src="../public/sprites/characters/chara_0.png">
            <img id="mob1" src="../public/sprites/characters/pinguin_22x22.png">
            <img id="env1" src="../public/sprites/environment/ground.png">
            <img id="chest1" src="../public/sprites/items/chest.png">
        </div>

        <!-- TSX -->
        <script id="test-tsx" type="text/xml">
            <tileset version="1.10" tiledversion="1.10.2" name="test" tilewidth="16" tileheight="16" tilecount="60" columns="20">
             <image source="../sprites/environment/ground.png" width="320" height="48"/>
            </tileset>
        </script>

        <!-- TMX -->
        <script id="test-tmx" type="text/xml">
            <map version="1.10" tiledversion="1.10.2" orientation="orthogonal" renderorder="right-down" width="30" height="30" tilewidth="16" tileheight="16" infinite="0" nextlayerid="4" nextobjectid="1">
             <tileset firstgid="1" source="test.tsx"/>
                 <layer id="1" name="Ground" width="30" height="30">
                  <data encoding="csv">
                25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,
                25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,
                37,25,7,8,8,8,9,25,37,25,25,25,25,25,25,25,25,25,25,25,25,25,25,7,8,8,8,9,25,25,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,25,25,25,25,25,37,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,37,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,37,27,28,28,28,29,25,37,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,60,25,25,25,25,25,37,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,25,25,1,2,2,2,2,2,2,2,2,2,2,3,25,25,27,28,28,28,29,25,25,
                25,25,47,48,48,48,49,25,25,21,22,22,22,22,22,22,22,22,22,22,23,25,25,47,48,48,48,49,25,25,
                25,25,25,25,25,25,25,25,25,21,22,22,22,22,22,22,22,22,22,22,23,25,25,25,25,25,25,25,25,25,
                25,25,25,25,25,25,25,25,25,21,22,22,4,5,5,5,5,6,22,22,23,25,25,25,25,25,25,25,37,25,
                25,25,25,25,25,25,25,25,37,21,22,22,24,25,25,25,25,26,22,22,23,25,25,25,37,25,25,25,25,25,
                25,25,25,25,25,25,25,25,25,21,22,22,24,25,25,25,25,26,22,22,23,25,25,25,25,25,25,25,25,25,
                25,25,25,25,25,37,25,25,25,21,22,22,24,25,25,25,25,26,22,22,23,25,25,25,25,25,25,25,25,25,
                25,25,25,37,25,25,25,25,25,21,22,22,24,25,25,25,25,26,22,22,23,25,25,25,37,25,25,25,25,25,
                25,25,25,25,25,25,25,25,25,21,22,22,44,45,45,45,45,46,22,22,23,25,25,25,25,25,25,25,25,25,
                25,25,25,25,25,25,25,25,25,21,22,22,22,22,22,22,22,22,22,22,23,25,25,25,25,25,25,25,25,25,
                25,25,7,8,8,8,9,25,25,21,22,22,22,22,22,22,22,22,22,22,23,37,25,7,8,8,8,9,25,25,
                25,25,27,28,28,28,29,25,25,41,42,42,42,42,42,42,42,42,42,42,43,25,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,25,25,25,25,37,25,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,37,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,27,28,28,28,29,25,25,
                25,25,27,28,28,28,29,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,27,28,28,28,29,25,25,
                25,25,47,48,48,48,49,25,37,25,25,25,25,25,25,25,25,25,37,37,25,25,37,47,48,48,48,49,25,25,
                25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,
                25,25,37,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25
                </data>
                 </layer>
                 <layer id="2" name="Colliders" width="30" height="30">
                  <data encoding="csv">
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,19,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,57,20,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,16,17,17,17,17,18,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,38,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,36,0,25,0,0,38,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,38,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,50,51,52,0,0,0,0,0,0,56,57,57,57,0,58,0,0,0,0,0,0,50,51,52,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,39,17,17,17,17,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,17,17,17,17,40,0,
                0,0,0,0,0,0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,0,0,
                0,0,0,0,0,0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,0,0,
                0,0,0,0,0,0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,0,0,
                0,0,53,54,55,0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,53,54,55,0,0,
                0,0,0,0,0,0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,0,0,
                0,0,0,0,0,0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,0,0,
                0,19,57,57,57,57,58,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,57,57,57,57,20,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,50,51,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,50,51,52,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,
                0,39,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,40,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
                </data>
                 </layer>
                 <layer id="3" name="Cover" width="30" height="30">
                  <data encoding="csv">
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,10,11,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,0,0,0,
                0,0,0,30,31,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,31,32,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,14,15,0,0,
                0,0,33,34,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,33,34,35,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,10,11,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,0,0,0,
                0,0,0,30,31,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,31,32,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
                </data>
                 </layer>
            </map>
        </script>

        <!-- Main canvas window -->
        <canvas id="main"></canvas>

        <div id="fps">FPS:</div>

        <!-- Init -->
        <script type="text/javascript">

            // Globals
            const canvas = document.getElementById('main');
            const context = canvas.getContext('2d');
            let player = null;
            let mob = null;
            let tileset = null;
            let level = null;
            let render = null;
            const scale = 4;
            const scroll = {x: 0, y: 0, ox: 0, oy: 0};

            // Random number in range
            function random(min, max) {
                return Math.random() * (max - min) + min;
            }

            // Round number
            function roundToNearestEven(number) {
                let roundedNumber = Math.round(number);
                if (roundedNumber % 2 !== 0) roundedNumber += 1;
                return roundedNumber;
            }

            // Window
            function fitCanvas() {
                canvas.width = roundToNearestEven(window.innerWidth);
                canvas.height = roundToNearestEven(window.innerHeight);
                context.imageSmoothingEnabled = false;
                context.webkitImageSmoothingEnabled = false;
                context.mozImageSmoothingEnabled = false;
            }

            // Input actions
            const input = {
                up: false,
                down: false,
                left: false,
                right: false,
                action: false
            };

            const keyDownHandler = (event) => {
                if (event.code == 'ArrowRight' || event.code == 'KeyD') {
                    input.right = true;
                }
                else if (event.code == 'ArrowLeft' || event.code == 'KeyA') {
                    input.left = true;
                }
                if (event.code == 'ArrowUp' || event.code == 'KeyW') {
                    input.up = true;
                }
                else if (event.code == 'ArrowDown' || event.code == 'KeyS') {
                    input.down = true;
                }
                if (event.code == 'Space' || event.code == 'ControlRight' || event.code == 'ControlLeft' || event.key == 'Enter') {
                    input.action = true;
                }
            };

            const keyUpHandler = (event) => {
                if (event.code == 'ArrowRight' || event.code == 'KeyD') {
                    input.right = false;
                }
                if (event.code == 'ArrowLeft' || event.code == 'KeyA') {
                    input.left = false;
                }
                if (event.code == 'ArrowUp' || event.code == 'KeyW') {
                    input.up = false;
                }
                if (event.code == 'ArrowDown' || event.code == 'KeyS') {
                    input.down = false;
                }
                if (event.code == 'Space' || event.code == 'ControlRight' || event.code == 'ControlLeft' || event.key == 'Enter') {
                    input.action = false;
                }
            };

            // Keyboard input
            document.addEventListener('keydown', keyDownHandler);
            document.addEventListener('keyup', keyUpHandler);

            // Init
            window.addEventListener('load', () => {

                // Canvas init
                fitCanvas();

                // Player
                player = new Player({
                    canvas,
                    context,
                    resource: '#char1',
                    width: 48,
                    height: 80,
                    cols: 3,
                    rows: 4,
                    scale: scale,
                    speed: 320,
                    anim: {
                        speed: 10,
                        idle: [1],
                        moveUp: [9, 10, 11],
                        moveDown: [0, 1, 2],
                        moveLeft: [3, 4, 5],
                        moveRight: [6, 7, 8],
                    },
                    collider: {
                        x: 7,
                        y: 50,
                        width: 50,
                        height: 30
                    },
                    scroll: {
                        top: -150,
                        bottom: 150,
                        left: -150,
                        right: 150
                    }
                });
                player.idle();

                // Tileset for ground
                const loaderTSX = new LoaderTSX({canvas, context, scale});
                tileset = loaderTSX.parseTileSet(document.getElementById('test-tsx').innerText, '#env1');

                // Map
                const loaderTMX = new LoaderTMX();
                level = loaderTMX.parseLevel(document.getElementById('test-tmx').innerText);
                scroll.x = scroll.ox = -1 * (((level.env.ground[0].length * tileset.tile.scaled.width) / 2) - (player.tile.scaled.width / 2));
                scroll.y = scroll.oy = -1 * (((level.env.ground.length * tileset.tile.scaled.height) / 2) - (player.tile.scaled.height / 2));

                // MOB
                mob = new MOB({
                    canvas,
                    context,
                    resource: '#mob1',
                    width: 88,
                    height: 88,
                    cols: 4,
                    rows: 4,
                    scale: scale,
                    speed: 150,
                    anim: {
                        speed: 10,
                        idle: [1],
                        moveUp: [8, 9, 10],
                        moveDown: [0, 1, 2],
                        moveLeft: [12, 13, 14],
                        moveRight: [4, 5, 6],
                    },
                    collider: {
                        x: 0,
                        y: 0,
                        width: 88,
                        height: 88
                    },
                    transform: {
                        x: 280,
                        y: 0
                    }
                });
                mob.wander();

                // Chest
                level.items['chest'] = new Item({
                    canvas,
                    context,
                    resource: '#chest1',
                    width: 32,
                    height: 16,
                    cols: 2,
                    rows: 1,
                    scale: scale,
                    transform: {
                        x: -30,
                        y: -600
                    },
                    anim: {
                        closed: 0,
                        open: 1
                    },
                    collider: {
                        x: -28,
                        y: -28,
                        width: 30,
                        height: 30
                    }
                });
                level.items.chest.animate('closed');

                // Renderer
                render = new Render({ canvas: document.getElementById('main') });

                // Start
                requestAnimationFrame(function(currentTime) {
                    lastTime = currentTime;
                    mainLoop(currentTime);
                });

            });

            // Resize
            window.addEventListener('resize', () => {
                fitCanvas();
            });

            // Main loop
            let lastTime = 0;
            let fpsContainer = document.querySelector('#fps');
            const mainLoop = (currentTime) => {

                // Universal frame time
                const deltaTime = (currentTime - lastTime) / 1000;

                // Calculate FPS
                fpsContainer.textContent = `FPS: ${Math.round(1 / deltaTime)}`;

                // Clear screen
                context.clearRect(0, 0, canvas.width, canvas.height);

                // Player movement
                if (input.up) {
                    const pixels = player.collideUp({
                        deltaTime,
                        left: scroll.x + (window.innerWidth / 2) - ((16 * scale) / 2),
                        top: scroll.y + (window.innerHeight / 2) - ((16 * scale) / 2),
                        tiles: level.env.colliders,
                        edge: 16 * scale
                    });
                    player.animUp(deltaTime);
                    scroll.y += player.moveUp(Math.round(pixels));
                }
                else if (input.down) {
                    const pixels = player.collideDown({
                        deltaTime,
                        left: scroll.x + (window.innerWidth / 2) - ((16 * scale) / 2),
                        top: scroll.y + (window.innerHeight / 2) - ((16 * scale) / 2),
                        tiles: level.env.colliders,
                        edge: 16 * scale
                    });
                    player.animDown(deltaTime);
                    scroll.y -= player.moveDown(Math.round(pixels));
                }
                if (input.left) {
                    const pixels = player.collideLeft({
                        deltaTime,
                        left: scroll.x + (window.innerWidth / 2) - ((16 * scale) / 2),
                        top: scroll.y + (window.innerHeight / 2) - ((16 * scale) / 2),
                        tiles: level.env.colliders,
                        edge: 16 * scale
                    });
                    player.animLeft(deltaTime);
                    scroll.x += player.moveLeft(Math.round(pixels));
                }
                else if (input.right) {
                    const pixels = player.collideRight({
                        deltaTime,
                        left: scroll.x + (window.innerWidth / 2) - ((16 * scale) / 2),
                        top: scroll.y + (window.innerHeight / 2) - ((16 * scale) / 2),
                        tiles: level.env.colliders,
                        edge: 16 * scale
                    });
                    player.animRight(deltaTime);
                    scroll.x -= player.moveRight(Math.round(pixels));
                }

                // Player actions
                if (input.action) {
                    if (player.collideWith(level.items.chest, {x: scroll.x - scroll.ox, y: scroll.y - scroll.oy})) level.items.chest.animate('open');
                }

                // Ground layer
                tileset.renderList({x: scroll.x, y: scroll.y, tiles: level.env.ground, first: 1});

                // Colliders layer
                tileset.renderList({x: scroll.x, y: scroll.y, tiles: level.env.colliders, first: 1});

                // Items layer
                level.renderItems({x: scroll.x - scroll.ox, y: scroll.y - scroll.oy});

                // Render MOBs
                mob.update({
                    deltaTime,
                    left: scroll.x + (window.innerWidth / 2) - ((16 * scale) / 2),
                    top: scroll.y + (window.innerHeight / 2) - ((16 * scale) / 2),
                    tiles: level.env.colliders,
                    edge: 16 * scale
                });
                mob.render({x: scroll.x - scroll.ox, y: scroll.y - scroll.oy});

                // Render characters
                player.render();

                // Cover layer
                tileset.renderList({x: scroll.x, y: scroll.y, tiles: level.env.cover, first: 1});

                // Debug
                // player.debugDrawCollider();
                // level.items.chest.debugDrawCollider({x: scroll.x - scroll.ox, y: scroll.y - scroll.oy});
                /*player.debugDrawColliders({
                    left: scroll.x + (window.innerWidth / 2) - ((16 * scale) / 2),
                    top: scroll.y + (window.innerHeight / 2) - ((16 * scale) / 2),
                    tiles: level.env.colliders,
                    edge: 16 * scale
                });*/

                // Render draw
                render.draw(deltaTime);

                // Time udpate
                lastTime = currentTime;

                // Display synchro
                requestAnimationFrame(mainLoop);
            }

        </script>

    </body>

</html>
